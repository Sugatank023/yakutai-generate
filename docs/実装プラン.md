# 薬袋印刷WEBシステム 実装プラン

## 1. 目的
- 薬袋（A5）のプレビュー・印刷を行えるWEBシステムを構築する。
- 技術スタックは **PHP + JavaScript + SQLite** を採用する。
- 医薬品マスタを検索・登録できるようにし、患者名は印刷時に都度入力できるようにする。

---

## 2. 想定機能一覧

### 2.1 薬袋作成・印刷機能
- 医薬品種別を選択（外用薬 / 内服薬 / 漢方薬 / 頓服薬）
- 患者名を手入力
- 医薬品名で検索し、候補から選択
- 用法・用量・1日回数・医薬品説明を読み込み
- A5レイアウトでプレビュー
- ブラウザ印刷（A5固定）

### 2.2 医薬品管理機能（管理画面）
- 新規医薬品登録
- 既存医薬品の一覧表示
- 医薬品名検索
- 編集・削除（運用を考えると必須）

### 2.3 薬局情報管理
- 薬局名、住所、電話番号、FAX番号を別テーブルで管理
- 単一薬局想定の場合は「1レコード運用」
- 将来的に複数薬局対応可能な構造にしておく

---

## 3. 画面設計（最小構成）

1. **薬袋作成画面（メイン）**
   - 入力項目：患者名、医薬品種別、医薬品検索
   - 表示：プレビュー（A5）
   - 操作：印刷ボタン

2. **医薬品管理画面**
   - 一覧・検索
   - 新規登録フォーム
   - 編集・削除

3. **薬局情報設定画面**
   - 薬局情報の表示・更新

---

## 4. DB設計（SQLite）

### 4.1 テーブル: medicines
医薬品情報を管理する主テーブル。

- `id` INTEGER PRIMARY KEY AUTOINCREMENT
- `medicine_name` TEXT NOT NULL
- `medicine_type` TEXT NOT NULL
  - 値例: `external`, `internal`, `kampo`, `as_needed`
- `dosage_usage` TEXT NOT NULL
  - 例: 朝食後、毎食後、就寝前
- `dosage_amount` TEXT NOT NULL
  - 例: 1回1錠、1回1包
- `daily_frequency` TEXT NOT NULL
  - 例: 1日1回、1日2回、1日3回、1日数回
- `description` TEXT
- `created_at` TEXT NOT NULL
- `updated_at` TEXT NOT NULL

#### 推奨インデックス
- `INDEX idx_medicines_name (medicine_name)`
- `INDEX idx_medicines_type (medicine_type)`

### 4.2 テーブル: pharmacies
薬局情報を管理するテーブル。

- `id` INTEGER PRIMARY KEY AUTOINCREMENT
- `pharmacy_name` TEXT NOT NULL
- `address` TEXT NOT NULL
- `phone` TEXT NOT NULL
- `fax` TEXT NOT NULL
- `created_at` TEXT NOT NULL
- `updated_at` TEXT NOT NULL

---

## 5. レイアウト仕様（A5薬袋）

印刷領域を `@page size: A5;` で固定し、以下の順で表示。

1. 上部：医薬品種別
2. その下：患者様名
3. 中部枠内：用法・用量・1日回数
4. その下：医薬品名
5. その下：医薬品説明
6. 枠外下部：薬局名、住所、電話番号、FAX番号

### 実装メモ
- 画面表示用CSSと印刷用CSSを分離（`screen` / `print`）。
- 印刷時は入力UIを非表示にし、薬袋本体のみ表示。
- 印刷崩れを防ぐため、行高・余白・枠線を固定値で定義。

---

## 6. アプリ構成案（PHP + JS）

### 6.1 ディレクトリ例
- `public/` : エントリポイント、静的ファイル
- `app/Controllers/` : 画面/API制御
- `app/Models/` : DBアクセス
- `app/Views/` : 画面テンプレート
- `database/` : SQLiteファイル、マイグレーションSQL
- `docs/` : 仕様・運用ドキュメント

### 6.2 API（最小）
- `GET /api/medicines?keyword=...` : 医薬品名検索
- `POST /api/medicines` : 医薬品登録
- `PUT /api/medicines/{id}` : 医薬品更新
- `DELETE /api/medicines/{id}` : 医薬品削除
- `GET /api/pharmacy` : 薬局情報取得
- `PUT /api/pharmacy` : 薬局情報更新

---

## 7. 入力バリデーション方針

- 患者名：必須、文字数上限（例: 50）
- 医薬品名：必須、重複時の扱いを定義（同名別規格がありうるため運用ルール化）
- 医薬品種別：許可値のみ
- 電話・FAX：形式チェック（ハイフン含む許可）
- すべてサーバー側で再検証

---

## 8. 開発工程（段階的実装）

### Phase 1: 基盤整備
- プロジェクト雛形作成
- SQLite接続設定
- テーブル作成SQL/マイグレーション準備

### Phase 2: マスタ管理機能
- 医薬品CRUD
- 薬局情報CRUD（実質Update中心）
- 医薬品検索API

### Phase 3: 薬袋画面
- 入力フォーム実装
- API連携（医薬品選択で情報自動反映）
- A5プレビュー実装

### Phase 4: 印刷最適化
- 印刷CSS最適化
- 主要ブラウザで印刷確認
- レイアウト微調整

### Phase 5: 品質担保
- 入力バリデーション強化
- 異常系チェック（未入力、該当なし検索など）
- 運用手順書作成

---

## 9. 受け入れ基準（Doneの定義）

- 患者名を毎回手入力して薬袋を作成できる。
- 医薬品名検索で該当データを呼び出せる。
- 管理画面から医薬品を新規登録できる。
- A5でプレビュー表示と印刷ができ、指定項目が所定位置に表示される。
- 薬局情報が下部に表示される。
- 主要操作でエラーなく完了する。

---

## 10. 今後の拡張候補
- 処方履歴保存（監査用）
- 患者ごとの定型文テンプレート
- バーコード/QRコード付与
- CSVインポート（医薬品マスタ一括登録）
